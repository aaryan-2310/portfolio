<!-- Chat Toggle Button -->
<button class="chat-toggle" [class.open]="isOpen" (click)="toggleChat()" aria-label="Open AI Chat">
    <span class="material-icons toggle-icon">{{ isOpen ? 'close' : 'smart_toy' }}</span>
    <span class="pulse-ring" *ngIf="!isOpen"></span>
</button>

<!-- Chat Window -->
<div class="chat-window" [class.open]="isOpen" role="dialog" aria-label="AI Chat Assistant">
    <!-- Header -->
    <header class="chat-header">
        <div class="header-info">
            <div class="avatar-container">
                <span class="material-icons avatar">smart_toy</span>
                <span class="online-indicator"></span>
            </div>
            <div class="header-text">
                <h3>AI Assistant</h3>
                <span class="status">Online & Ready to help</span>
            </div>
        </div>
        <button class="close-btn" (click)="closeChat()" aria-label="Close chat">
            <span class="material-icons">close</span>
        </button>
    </header>

    <!-- Messages -->
    <div class="chat-messages" #messagesContainer>
        <div class="message-group" *ngFor="let msg of messages">
            <div class="message" [class.user]="msg.role === 'user'" [class.assistant]="msg.role === 'assistant'">
                <div class="message-avatar" *ngIf="msg.role === 'assistant'">
                    <span class="material-icons">smart_toy</span>
                </div>
                <div class="message-content">
                    <p>{{ msg.content }}</p>
                </div>
            </div>
            <span class="timestamp">{{ msg.timestamp | date:'shortTime' }}</span>
        </div>

        <!-- Typing Indicator -->
        <div class="message assistant typing" *ngIf="isLoading">
            <div class="message-avatar">
                <span class="material-icons">smart_toy</span>
            </div>
            <div class="message-content">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Suggestions -->
    <div class="suggestions" *ngIf="suggestions.length > 0 && messages.length <= 1">
        <button class="suggestion-chip" *ngFor="let suggestion of suggestions" (click)="selectSuggestion(suggestion)">
            {{ suggestion }}
        </button>
    </div>

    <!-- Input -->
    <footer class="chat-input">
        <div class="input-wrapper">
            <input #messageInput type="text" [(ngModel)]="inputMessage" (keydown)="onKeydown($event)"
                placeholder="Ask me anything..." [disabled]="isLoading" />
        </div>
        <button class="send-btn" (click)="sendMessage()" [disabled]="!inputMessage.trim() || isLoading"
            aria-label="Send message">
            <span class="material-icons">send</span>
        </button>
    </footer>
</div>